const discount = new Vue({
    el: "#discount",
    data () {
        return {
            make: '',
            presents: [],
            presentation: '',
            discounts: null,
            result: {
                code1: null,
                code2: null,
                code3: null,
                to: null,
                from: null,
                accept: 0,
                id: null
            }
        }
    },
    filters: {
        dateString: function (value) {
            moment.locale('es');
            return moment(value).format("D [de] MMMM [del] YYYY");
        },
        dateDay: function (value) {
            moment.locale('es');
            return moment(value).format("D/M/YYYY");
        }
    },
    methods: {
        buscar: function () {
            let self = this;
            $.get('/api/make/' + self.make + '/discount/' + self.presentation, function (data) {
                self.discounts = data;
                $("#scrollBuscador").focus();
            });
        },
        show: function (discount) {
            this.result.code1 = discount.code1;
            this.result.code2 = discount.code2;
            this.result.code3 = discount.code3;
            this.result.to = discount.to_date;
            this.result.from = discount.from_date;
            this.result.id = discount.id;

            $(".c-modalCupon").show();
        }
    },
    computed: {
        Save: function () {
            return "/cupon.pdf"
            //return "/download/discount/" + this.result.id
        },
        Print: function () {
            return "/cupon.pdf"
            //return "/print/discount/" + this.result.id
        },
        Send: function () {
            return "mailto:?body="+window.location.host +"/cupon.pdf?subject=Cupon" + this.result.id
        },
    },
    watch: {
        make: function (value) {
            let self = this;
            $.get('/api/make/' +  value +  '/presentation', function (data) {
                self.presents = data.map(function (value) {
                    return {'id': value.id, 'presentation': value.presentation}
                });
                self.presentation = '';
                self.discounts = data;
                $("#scrollBuscador").focus();
            })
        }
    }
});

$(window).scroll(function() {
    if($(this).scrollTop() > 146)
    {
        $('.c-header__nav').addClass('header-fixed');
    } else {
        $('.c-header__nav').removeClass('header-fixed');
    }
});

$(window).scroll(function() {
    if($(this).scrollTop() > 146)
    {
        $('.c-header__top').addClass('pad-b-55');
    } else {
        $('.c-header__top').removeClass('pad-b-55');
    }

});

$(window).scroll(function() {
    if($(this).scrollTop() > 220)
    {
        $('.c-brand-bienestar').css("opacity", "1");
    } else {
        $('.c-brand-bienestar').css("opacity", "0");
    }

});

$(window).scroll(function() {
    if($(this).scrollTop() > 220)
    {
        $('.c-header__nav .btnSaval').css("opacity", "1");
    } else {
        $('.c-header__nav .btnSaval').css("opacity", "0");
    }

});


$(document).ready(function(e) {

    var modal = $("#myModal");

    //cerramos cuando aprete en el background de la modal
    $(window).click(function(e){
        if(e.target.className == 'modal' ) {
            modal.hide();
        }
    });

    $(document).on("click", ".close", function(e){
        modal.hide();
    });

    $(document).on("click", ".btnSuscribirse", function(e){
        let input = $(this).parent().parent();
        if (input.has('#emailUser')) {
            email = $(input.find('#emailUser'));
        } else {
            email = $(input.parent().find('#emailUser'));
        }

        if ($(email).val() !== '' && validateEmail(email.val())) {
            modal.show();
        }
    });

    function validateEmail(email) {
        const regex = /^(([^<>()\[\]\\.,;:\s@"]+(\.[^<>()\[\]\\.,;:\s@"]+)*)|(".+"))@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\])|(([a-zA-Z\-0-9]+\.)+[a-zA-Z]{2,}))$/;
        return (regex.exec(email)) !== null;
    }

    $('[data-fancybox]').fancybox({
        loop : true
    });

    // Acordeon
    $('#c-boxes-down').on('click', '.c-savaTemas__box', function(){
        var t = $(this);
        var tp = t.find('p');
        var p = t.siblings().find('p');
        tp.slideToggle();
        p.slideUp();
    });

    // Acordeon faqs
    $('#itemsdown').on('click', '.c-faq__item', function(){
        var t = $(this);
        var ti = t.find('.c-faq__info');
        var pi = t.siblings().find('.c-faq__info');
        ti.slideToggle();
        pi.slideUp();
    });


    var win = $(window).width();


    $('.c-header__mobile-open').click(function(e){
        $('.c-header__navOpen').addClass('c-header__navOpen--open');
        e.preventDefault();
    });

    $('.close-nav').click(function (e) {
        $('.c-header__navOpen').removeClass('c-header__navOpen--open');
        e.preventDefault();
    });

    $('.c-modalCupon__overlay').click(function(e){
        $('.c-modalCupon').hide();

        e.preventDefault();
    });

    $('.buscadorResultados__button').click(function (e) {
        $('.c-modalCupon').show();

        e.preventDefault();
    });

    if(win < 992) {
        $('.c-modalMobile__btn').click(function (e) {
            $('.c-modalMobile__firstStep').removeClass('c-modalMobile__firstStep--active');
            $('.c-modalMobile__secondStep').addClass('c-modalMobile__secondStep--active');

            e.preventDefault();
        });

        $('.buscadorResultados__button').click(function (e) {
            $('.c-modalMobile').show();

            e.preventDefault();
        });

        $('.c-modalMobile__btn-imprimir').click(function (e) {
            $('.c-modalMobile__firstStep').addClass('c-modalMobile__firstStep--active');
            $('.c-modalMobile__secondStep').removeClass('c-modalMobile__secondStep--active');
            $('.c-modalMobile').hide();

            e.preventDefault();
        });
    }


    $('#slider').owlCarousel({
        loop: true,
        margin: 0,
        dots: true,
        nav: false,
        responsiveClass: true,
        //autoplay: true,
        autoplayTimeout: 5000,
        smartSpeed: 350,
        items: 1
    });

    $('#quienes-somos').owlCarousel({
        loop: true,
        margin: 0,
        nav: true,
        autoplay: true,
        autoplayTimeout: 5000,
        autoplayHoverPause: false,
        responsive: {
            0: {
                items: 1
            },
            600: {
                items: 3
            },
            1000: {
                items: 5
            }
        }
    })
});

$(window).on('load', function () {
    $('.c-blog__articles').masonry({
        itemSelector: '.c-blog__article',
        columnWidth: '.grid-sizer'
    });


    window.sr = ScrollReveal({ reset: true });
    sr.reveal('.c-blog__article', {
        duration   : 800,
        reset      : true,
        distance   : "50px",
        delay	   : 0,
        scale      : 0.9,
        viewFactor : 0.2,
        scale      : 0.99
    });
});